[www]
; Run as www-data (nginx user)
user = www-data
group = www-data

; ============================================================================
; CRITICAL: TCP socket for Railway (Unix sockets unreliable in containers)
; Nginx connects to this with: fastcgi_pass 127.0.0.1:9000;
; ============================================================================
listen = 127.0.0.1:9000
listen.allowed_clients = 127.0.0.1

; ============================================================================
; Process manager: dynamic for auto-scaling
; ============================================================================
pm = dynamic
pm.max_children = 20
pm.start_servers = 4
pm.min_spare_servers = 2
pm.max_spare_servers = 6
pm.max_requests = 500
pm.max_spawn_rate = 5
pm.process_idle_timeout = 30s

; ============================================================================
; Communication and error handling
; ============================================================================
request_terminate_timeout = 300s
request_slowlog_timeout = 10s
slowlog = /dev/stderr

; CRITICAL: Capture worker output (startup errors, warnings, etc.)
catch_workers_output = yes

; Error handling - these settings are in php.ini, not here
php_flag[display_errors] = off
php_admin_flag[log_errors] = on

; ============================================================================
; Pass environment variables to PHP scripts
; ============================================================================
; DO NOT use 'clear_env = no' anymore - use explicit env[] settings
clear_env = yes

; Pass critical Symfony environment variables
env[APP_ENV] = prod
env[APP_DEBUG] = 0
env[KERNEL_CLASS] = App\\Kernel
env[KERNEL_DIR] = /var/www/app/src

; Pass through PATH for bin/console execution
env[PATH] = /usr/local/bin:/usr/bin:/bin

; ============================================================================
; Logging configuration
; ============================================================================
access.log = /dev/null
php_value[sendmail_path] = /usr/sbin/sendmail -t -i
