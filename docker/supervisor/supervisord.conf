; Supervisor configuration for managing Nginx and PHP-FPM

[supervisord]
nodaemon = true
logfile = /var/log/supervisor/supervisord.log
pidfile = /var/run/supervisord.pid
user = root

[unix_http_server]
file = /var/run/supervisor.sock
chmod = 0700

[supervisorctl]
serverurl = unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

; PHP-FPM process
[program:php-fpm]
command = %(ENV_PHP_FPM_CMD)s
autostart = true
autorestart = true
stderr_logfile = /var/log/supervisor/php-fpm.err.log
stdout_logfile = /var/log/supervisor/php-fpm.out.log
stdout_logfile_maxbytes = 10MB
stdout_logfile_backups = 10
priority = 999
startsecs = 10
stopasgroup = true
killasgroup = true
process_name = %(program_name)s_%(process_num)02d

; Nginx process
[program:nginx]
command = /usr/sbin/nginx -g "daemon off;"
autostart = true
autorestart = true
stderr_logfile = /var/log/supervisor/nginx.err.log
stdout_logfile = /var/log/supervisor/nginx.out.log
stdout_logfile_maxbytes = 10MB
stdout_logfile_backups = 10
priority = 998
startsecs = 5
stopasgroup = true
killasgroup = true
process_name = %(program_name)s

; Group for graceful restart
[group:app]
programs = php-fpm,nginx
priority = 999
